var t={};class e{static initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];static status={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=e.initialState){this.initialState=JSON.parse(JSON.stringify(t)),this.state=JSON.parse(JSON.stringify(t)),this.status=e.status.idle,this.score=0}moveLeft(){"playing"===this.getStatus()&&(this.state=this.moveAndMerge(this.state,"left"))}moveRight(){"playing"===this.getStatus()&&(this.state=this.moveAndMerge(this.state,"right"))}moveUp(){"playing"===this.getStatus()&&(this.state=this.moveAndMerge(this.state,"up"))}moveDown(){"playing"===this.getStatus()&&(this.state=this.moveAndMerge(this.state,"down"))}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.status.playing,this.addRandomTile(this.state),this.addRandomTile(this.state)}restart(){this.status=e.status.idle,this.state=JSON.parse(JSON.stringify(this.initialState)),this.score=0}moveAndMerge(t,s){let a=JSON.parse(JSON.stringify(t)),i=a.length,r=(t,s=!1)=>{s&&t.reverse();let a=t.filter(t=>0!==t);for(let t=0;t<a.length-1;t++)a[t]===a[t+1]&&(a[t]*=2,a[t+1]=0,this.score+=a[t],2048===this.score&&(this.status=e.status.win));let i=a.filter(t=>0!==t);for(;i.length<t.length;)i.push(0);return s&&i.reverse(),i},l=(t,e)=>t.map(t=>t[e]),n=(t,e,s)=>{s.forEach((s,a)=>{t[a][e]=s})};if("left"===s||"right"===s){let t="right"===s;for(let e=0;e<i;e++)a[e]=r(a[e],t)}else if("up"===s||"down"===s){let t="down"===s;for(let e=0;e<i;e++){let s=r(l(a,e),t);n(a,e,s)}}return JSON.stringify(t)===JSON.stringify(a)?(this.movesAvailable(t)||(this.status=e.status.lose),t):"win"===this.status?t:this.addRandomTile(a)}addRandomTile(t){let e=t.length,s=[];for(let a=0;a<e;a++)for(let i=0;i<e;i++)0===t[a][i]&&s.push([a,i]);if(0===s.length)return t;let[a,i]=s[Math.floor(Math.random()*s.length)];return t[a][i]=.1>Math.random()?4:2,t}movesAvailable(t){let e=t.length;for(let s=0;s<e;s++)for(let a=0;a<e;a++)if(0===t[s][a])return!0;for(let s=0;s<e;s++)for(let a=0;a<e;a++)if(a<e-1&&t[s][a]===t[s][a+1]||s<e-1&&t[s][a]===t[s+1][a])return!0;return!1}}const s=new(t=e),a=document.querySelector(".start"),i=[...document.querySelector(".game-field").querySelectorAll(".field-row")],r=document.querySelector(".message-start"),l=document.querySelector(".game-score"),n=document.querySelector(".message-lose"),o=document.querySelector(".message-win"),h=()=>{s.getState().forEach((t,e)=>{t.forEach((t,s)=>{let a=i[e].children[s];a.className="field-cell",t?(a.classList.add(`field-cell--${t}`),a.textContent=t):a.textContent=""})})};a.addEventListener("click",()=>{let e=s.status===t.status.playing;s.status===t.status.idle?s.start():s.restart(),h(),a.className=e?"button start":"button restart",a.textContent=e?"Start":"Restart",r.style=`display: ${e?"block":"none"}`,l.textContent=s.getScore(),n.classList.add("hidden")}),document.addEventListener("keydown",t=>{if(t.preventDefault(),"playing"===s.getStatus()){switch(t.key){case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;default:return}h(),l.textContent=s.getScore(),"lose"===s.getStatus()&&n.classList.toggle("hidden"),"win"===s.getStatus()&&o.classList.toggle("hidden")}});
//# sourceMappingURL=index.6252b983.js.map
